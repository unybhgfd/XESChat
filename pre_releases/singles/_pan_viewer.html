<!--    MIT License                                                                       -->
<!--                                                                                      -->
<!--    Copyright (c) 2025 unybhgfd                                                       -->
<!--                                                                                      -->
<!--    Permission is hereby granted, free of charge, to any person obtaining a copy      -->
<!--    of this software and associated documentation files (the "Software"), to deal     -->
<!--    in the Software without restriction, including without limitation the rights      -->
<!--    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell         -->
<!--    copies of the Software, and to permit persons to whom the Software is             -->
<!--    furnished to do so, subject to the following conditions:                          -->
<!--                                                                                      -->
<!--    The above copyright notice and this permission notice shall be included in all    -->
<!--    copies or substantial portions of the Software.                                   -->
<!--                                                                                      -->
<!--    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR        -->
<!--    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,          -->
<!--    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE       -->
<!--    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER            -->
<!--    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,     -->
<!--    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE     -->
<!--    SOFTWARE.                                                                         -->
<!--                                                                                      -->
<!--             本页面是XESChat的一部分, 代码版权为MIT License, 请自觉遵守.              -->

<!-- https://livefile.xesimg.com/programme/python_assets/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.html#xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.xxxx_xxxxxxxxxxxxx -->
<!-- https://livefile.xesimg.com/programme/python_assets/74c8c75f1bff72c09e3c662867426015.html （修改后记得重新上传） -->
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://livefile.xesimg.com/programme/python_assets/a15c2ac3234aa8f6064ef9c1f7383c37.css">
    <script src="https://livefile.xesimg.com/programme/python_assets/450d478c0491cf0b2d365997faff70dd.js"></script>
    <script src="https://livefile.xesimg.com/programme/python_assets/8925116b63282ad29fe2259ab4768694.js"></script>
    <script src="https://livefile.xesimg.com/programme/python_assets/e1d98d47689e00f8ecbc5d9f61bdb42e.js"></script>

    <!-- catppuccin-icons_data.js -->
    <script src="https://livefile.xesimg.com/programme/python_assets/4be1829fabdb641338f00a0c0d189a33.js"></script>

    <title>文件查看</title>
</head>
<body>
<div class="container">
    <br>
<!-- TODO -->
    <script>
        const OSS_URL = "https://livefile.xesimg.com/programme/python_assets/"

        /**
         * @param {string} dirName
         * */
        function getDirIconUrl(dirName) {
            let icon = OSS_URL+"cad19b88620ade8a5d9cdc002b436c7c.svg"
            if (folderName2Icon[dirName]) {
                icon = OSS_URL + folderName2Icon[dirName]
            }
            return icon
        }

        /**
         * @param {string} fileName
         */
        function getFileIconUrl(fileName) {
            let icon = OSS_URL+"567eb7b5df24e99f9fe7fe4b1b0a40de.svg"
            if (fileName2Icon[fileName]) {
                icon = OSS_URL + fileName2Icon[fileName]
            } else {
                let exts = fileName.split(".")
                if (exts.length > 1) {
                    let fileExt = exts[exts.length-1]
                    if (fileExtension2Icon[fileExt]) {
                        icon = OSS_URL + fileExtension2Icon[fileExt]
                    }
                }
            }
            return icon
        }

        function generateDirElem(dirName) {
            let dirElem = document.createElement("a")
            dirElem.className = "list-group-item list-group-item-action"
            dirElem.innerHTML = `
            <span class="d-inline">
                <img alt="img" src="${getDirIconUrl(dirName.toLowerCase())}">
            </span>
            <pre class="d-inline"></pre>
            `
            dirElem.children[1].innerText = dirName + "/"
            return dirElem
        }

        function generateFileElem(fileName) {
            let fileElem = document.createElement("a")
            fileElem.className = "list-group-item list-group-item-action"
            fileElem.innerHTML = `
            <span class="d-inline">
                <img alt="img" src="${getFileIconUrl(fileName.toLowerCase())}">
            </span>
            <pre class="d-inline"></pre>
            `
            fileElem.children[1].innerText = fileName
            return fileElem
        }

        /** @type {Record<string, string>} */
        $(document).ready(function () {
            // example: ?dirName=d4b9350ae1f014392d311b232cf9dcb7.4c4c_1761396520885
            //                   841de09e67618a382451061c0d078575.b275_1761393135704
            const rootOssFileName = (
                new window.URL(document.location.href)
            ).searchParams.get("dirName")

            fetch(
                OSS_URL+rootOssFileName,
                {
                    method: "GET",
                }
            ).then(async (resp) => {
                return JSON.parse(await resp.text())
            }).then((data) => {
                /** @type {Record<string, string>} */
                let dirs = data.directories
                /** @type {Record<string, string>} */
                let files = data.files

                const listGroupElem = document.getElementById("list-group")
                for (let key in dirs) {
                    let e = generateDirElem(key)
                    e.href = "?dirName=" + encodeURI(dirs[key])
                    listGroupElem.append(e)
                }
                for (let key in files) {
                    let e = generateFileElem(key)
                    e.href = OSS_URL + files[key]
                    listGroupElem.append(e)
                }
            })
        });
    </script>

    <div class="card">
        <div class="list-group list-group-flush" id="list-group">
        </div>
    </div>

    <br><hr>
    <ul class="row nav justify-content-center">
        <li class="nav-item">
            <a class="nav-link disabled" href="#">&copy; 2025 unybhgfd. All rights reserved.</a>
        </li>
    </ul>
</div>
</body>
</html>
